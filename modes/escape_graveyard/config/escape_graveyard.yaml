#config_version=6

mode:
  start_events: start_mode_escape_graveyard
  stop_events: ball_will_end, eg_complete, eg_failed
  priority: 220

# -----------------------------
# TIMERS
# -----------------------------
timers:
  # 11s one-shot to replace inline delay
  eg_intro_delay:
    start_value: 11
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: mode_escape_graveyard_started

  # 60s gameplay timer (starts right after eject)
  eg_timer:
    start_value: 60
    end_value: 0
    direction: down
    tick_interval: 1s
    control_events:
      - action: start
        event: eg_intro_release
      - action: stop
        event: eg_complete
      - action: stop
        event: eg_failed
      - action: stop
        event: mode_escape_graveyard_will_stop
# listen for: timer_eg_intro_delay_complete / timer_eg_timer_complete

# -----------------------------
# BALL HOLD
# -----------------------------
ball_holds:
  eg_intro_hold:
    hold_devices: bd_saucer        # your saucer ball device name
    balls_to_hold: 1
    enable_events: balldevice_bd_saucer_ball_enter
    release_one_events: eg_intro_release

# -----------------------------
# EVENTS (scenes, phase steps, success/fail)
# -----------------------------
event_player:
  # Mode starts: intro scene while ball is held (no ball_hold right now)
  sh_escape_graveyard_start_hit:
    - godot_play_graveyard_intro

  mode_escape_graveyard_started:
    - godot_play_graveyard_intro

  # After 11s → eject & begin Phase 1
  timer_eg_intro_delay_complete:
    - eg_intro_release

  eg_intro_release:
    - godot_stop_graveyard_intro
    - eg_phase1_begin

  # Phase 1 (6 shots) complete → enable spinner
  eg_phase1_complete:
    - eg_spinner_phase_begin

  # Spinner hit → Phase 2
  sh_eg_spinner_hit:
    - eg_phase2_begin

  # 60s timer ran out → fail
  timer_eg_timer_complete:
    - eg_fail_sequence

  # Drain during mode → fail as well
  ball_will_end:
    - eg_fail_sequence

  # Phase 2 done → success flow
  eg_complete:
    - eg_success_sequence

  # Success / Fail → play scene, then stop the mode (no inline delay)
  eg_success_sequence:
    - godot_play_graveyard_completed
    - eg_stop_mode_after_scene

  eg_fail_sequence:
    - godot_play_graveyard_failed
    - eg_stop_mode_after_scene

  # trigger the post-scene stop delay show
  eg_stop_mode_after_scene:
    - start_eg_stop_delay

# -----------------------------
# SOUND
# -----------------------------
sound_player:
  # Graveyard starts → play graveyard music (loop)
  mode_escape_graveyard_started:
    escape_graveyard_music:
      action: play
      priority: 100
      volume: 0.8

# -----------------------------
# SHOTS
# -----------------------------
shots:
  # Phase 1 — Right drops (any order)
  sh_eg_right_drop_left:
    switch: s_right_bank_target_left
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_right_drop_middle:
    switch: s_right_bank_target_middle
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_right_drop_right:
    switch: s_right_bank_target_right
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop

  # Phase 1 — Pops (any order)
  sh_eg_pop_left:
    switch: s_left_pop_bumper
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_pop_middle:
    switch: s_middle_pop_bumper
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_pop_right:
    switch: s_right_pop_bumper
    enable_events: eg_phase1_begin
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop

  # Spinner — enabled after Phase 1
  sh_eg_spinner:
    switch: s_spinner
    enable_events: eg_spinner_phase_begin
    disable_events: eg_phase2_begin, mode_escape_graveyard_will_stop

  # Phase 3 — Left drops (any order)
  sh_eg_left_drop_left:
    switch: s_left_bank_target_left
    enable_events: eg_phase2_begin
    disable_events: eg_complete, mode_escape_graveyard_will_stop
  sh_eg_left_drop_middle:
    switch: s_left_bank_target_middle
    enable_events: eg_phase2_begin
    disable_events: eg_complete, mode_escape_graveyard_will_stop
  sh_eg_left_drop_right:
    switch: s_left_bank_target_right
    enable_events: eg_phase2_begin
    disable_events: eg_complete, mode_escape_graveyard_will_stop

# -----------------------------
# ACCRUALS (phase gates)
# -----------------------------
accruals:
  eg_phase1:
    events:
      - sh_eg_right_drop_left_hit
      - sh_eg_right_drop_middle_hit
      - sh_eg_right_drop_right_hit
      - sh_eg_pop_left_hit
      - sh_eg_pop_middle_hit
      - sh_eg_pop_right_hit
    events_when_complete: eg_phase1_complete
    reset_on_complete: false

  eg_phase2:
    events:
      - sh_eg_left_drop_left_hit
      - sh_eg_left_drop_middle_hit
      - sh_eg_left_drop_right_hit
    events_when_complete: eg_complete
    reset_on_complete: false

# -----------------------------
# SHOW DEFINITIONS
# -----------------------------

# -----------------------------
# SHOW PLAYER
# -----------------------------
show_player:
  mode_escape_graveyard_started:
    eg_flash:
      action: play
      loops: -1
      speed: 1.0

  sh_eg_right_drop_left_hit:
    eg_flash: { action: stop }
  sh_eg_right_drop_middle_hit:
    eg_flash: { action: stop }
  sh_eg_right_drop_right_hit:
    eg_flash: { action: stop }

  eg_spinner_phase_begin:
    spinner_chase:
      action: play
      loops: -1
      speed: 1.0

  sh_eg_spinner_hit:
    spinner_chase: { action: stop }

  eg_phase2_begin:
    eg_flash_house:
      action: play
      loops: -1
      speed: 1.0

  sh_eg_left_drop_left_hit:
    eg_flash_house: { action: stop }
  sh_eg_left_drop_right_hit:
    eg_flash_house: { action: stop }


# -----------------------------
# LAMP CLEANUP
# -----------------------------
light_player:
  eg_complete:
    l_right_bank_left: off
    l_right_bank_middle: off
    l_right_bank_right: off
    l_spinner_first: off
    l_spinner_second: off
    l_spinner_third: off
    l_spinner_fourth: off
    l_spinner_adjacent: off
    l_left_bank_lower: off
    l_left_bank_upper: off

  mode_escape_graveyard_will_stop:
    l_right_bank_left: off
    l_right_bank_middle: off
    l_right_bank_right: off
    l_spinner_first: off
    l_spinner_second: off
    l_spinner_third: off
    l_spinner_fourth: off
    l_spinner_adjacent: off
    l_left_bank_lower: off
    l_left_bank_upper: off
