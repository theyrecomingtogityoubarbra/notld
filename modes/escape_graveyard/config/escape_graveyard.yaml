#config_version=6

mode:
  start_events: start_mode_escape_graveyard, escape_graveyard_start
  stop_events: ball_will_end, eg_mode_complete, eg_mode_failed, escape_graveyard_stop
  priority: 220

# -----------------------------
# HOLD BALL IN SAUCER FOR INTRO
# -----------------------------
ball_holds:
  eg_intro_hold:
    hold_devices: bd_saucer
    balls_to_hold: 1
    enable_events: mode_escape_graveyard_started
    release_one_events: eg_intro_release

# -----------------------------
# EVENTS (media, phase changes, callouts)
# -----------------------------
event_player:
  # Start intro (ball is held)
  mode_escape_graveyard_started:
    - eg_intro_begin

  "mode_escape_graveyard_will_stop{current_player.eg_success==1}":
    - godot_show_graveyard_completed     # plays graveyard_completed.tscn

  "mode_escape_graveyard_will_stop{current_player.eg_success==0}":
    - godot_show_graveyard_failed        # plays graveyard_failed.tscn
    
  # eg_intro_timer will fire eg_intro_release when it completes
  eg_intro_begin: [11s]

  # When the intro timer completes, release the hold (saucer will eject)
  timer_eg_intro_timer_complete:
    - eg_intro_release

  # Phase 2 begins → boost multiplier
  eg_phase2_started:
    - enable_house_lights
    - godot_show_graveyard_reach_house

  # when the 60s timer ends, mark failure
  timer_eg_mode_timer_complete:
    - eg_mode_failed

  # Spinner scream on the objective hit
  sh_eg_spinner_hit:
    - play_womanscream

  # Play a special sound when the RIGHT bank (all 3) is finished
  eg_rightbank_complete:
    - play_zombielong

  # Phase 1 completion: reset left bank, start the short delay, give reach-house bonus
  eg_phase1_complete:
    - pulse_c_drop_target_left
    - eg_phase2_delay_start
    - reach_house

  # When the short delay timer completes, actually start Phase 2
  timer_eg_phase2_delay_complete:
    - eg_phase2_started

variable_player:
  # default: not successful
  mode_escape_graveyard_started:
    eg_success: 0

  # mark success when the mode is completed
  eg_mode_complete:
    eg_success: 1

timers:
  eg_intro_timer:
    start_value: 7
    end_value: 0
    direction: down
    tick_interval: 1s
    start_running: false
    control_events:
      - action: restart
        event: eg_intro_begin

  eg_mode_timer:
    start_value: 60
    end_value: 0
    direction: down
    tick_interval: 1s
    start_running: false
    control_events:
      - action: restart
        event: mode_escape_graveyard_started

  eg_phase2_delay:
    start_value: 1
    end_value: 0
    direction: down
    tick_interval: 400ms
    start_running: false
    control_events:
      - action: restart
        event: eg_phase2_delay_start


# -----------------------------
# MEDIA: SLIDE + MUSIC
# -----------------------------
slide_player:
  eg_intro_begin:
    graveyard_intro:
      action: play
      priority: 300
      expire: "7s"          # was {config.eg_intro_seconds}s

  eg_phase1_complete:
    graveyard_reach_house:
      action: play
      priority: 300
      expire: "5s"          # was {config.eg_phase2_slide_seconds}s

sound_player:
  mode_escape_graveyard_started:
    escape_graveyard_music: { action: play, loops: -1, priority: 100, volume: 0.8 }
  eg_mode_complete:
    escape_graveyard_music: { action: stop }
  mode_escape_graveyard_will_stop:
    escape_graveyard_music: { action: stop }

segment_display_player:
  mode_escape_graveyard_started:
    info_display: { text: "EGOP" }
  eg_phase1_complete:
    info_display: { text: "HSE!" }   # “House!” – change to taste
  eg_mode_complete:
    info_display: { text: "DONE" }
  mode_escape_graveyard_will_stop:
    info_display: { text: "    " }

# -----------------------------
# SHOTS (PHASE 1 + PHASE 2)
# -----------------------------
shots:
  # Phase 1 — Right drop targets
  sh_eg_right_drop_left:
    switch: s_right_bank_target_left
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_right_drop_middle:
    switch: s_right_bank_target_middle
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_right_drop_right:
    switch: s_right_bank_target_right
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop

  # Phase 1 — Pops
  sh_eg_pop_left:
    switch: s_left_pop_bumper
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_pop_middle:
    switch: s_middle_pop_bumper
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop
  sh_eg_pop_right:
    switch: s_right_pop_bumper
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop

  # Phase 1 — Spinner
  sh_eg_spinner:
    switch: s_spinner
    enable_events: mode_escape_graveyard_started
    disable_events: eg_phase1_complete, mode_escape_graveyard_will_stop

  # Phase 2 — Left drop targets
  sh_eg_left_drop_left:
    switch: s_left_bank_target_left
    enable_events: eg_phase2_started
    disable_events: eg_mode_complete, mode_escape_graveyard_will_stop
  sh_eg_left_drop_middle:
    switch: s_left_bank_target_middle
    enable_events: eg_phase2_started
    disable_events: eg_mode_complete, mode_escape_graveyard_will_stop
  sh_eg_left_drop_right:
    switch: s_left_bank_target_right
    enable_events: eg_phase2_started
    disable_events: eg_mode_complete, mode_escape_graveyard_will_stop

# -----------------------------
# ACCRUALS
# -----------------------------
accruals:
  # -------- Phase 1: complete when all seven objectives are hit --------
  eg_phase1:
    events:
      - sh_eg_right_drop_left_hit
      - sh_eg_right_drop_middle_hit
      - sh_eg_right_drop_right_hit
      - sh_eg_pop_left_hit
      - sh_eg_pop_middle_hit
      - sh_eg_pop_right_hit
      - sh_eg_spinner_hit
    events_when_complete: eg_phase1_complete
    reset_on_complete: false

  # (Optional) Detect when the RIGHT drop bank (3 targets) is finished during Phase 1
  eg_rightbank:
    events:
      - sh_eg_right_drop_left_hit
      - sh_eg_right_drop_middle_hit
      - sh_eg_right_drop_right_hit
    events_when_complete: eg_rightbank_complete
    reset_on_complete: false

  # -------- Phase 2: complete when all three left drops are hit --------
  eg_phase2:
    events:
      - sh_eg_left_drop_left_hit
      - sh_eg_left_drop_middle_hit
      - sh_eg_left_drop_right_hit
    events_when_complete: eg_mode_complete
    reset_on_complete: false
